# Migration Guide

## Version 2.2 to 2.3

## 1. Requirements

* froxlor **2.0+**
* **PHP 7.4+** (>8.2 recommended)
* Required PHP extensions:
    * session, ctype, xml, filter, posix, mbstring, curl, gd, gmp, json
* Suggested PHP extensions:
    * bcmath, gnupg, zip

## 2. New features

- Ssh-key management via UI for customers using shell, details see [here](../../user-guide/ssh-keys/)
- API Call: new entity `SshKeys`, details see [here](../../api-guide/commands/sshkeys.html)
- API Call: new entity `EmailSender`, details see [here](../../api-guide/commands/emailsender.html)
- API Call: Customers.add()/update() -> added parameter `shell_allowed`
- API Call: Domains.add()/update() -> added parameter `http3` (nginx only)
- Configuration: Added support for debian 13 (Trixie)

## 3. Important changes

### Services support changes

- support for lighttpd webserver has been dropped (deprecated since v2.2, released 08/2024)

### Services configuration changes

#### PHP configuration defaults

The default sender address for the `sendmail_path` directive in PHP configurations is now `postmaster@{DOMAIN}`. Please verify your setup and make sure the `postmaster` address is valid and can receive mail.

#### Postfix / mysql-virtual_sender_permissions.cf

The sql-query for postfix's `smtpd_sender_login_maps` in `/etc/postfix/mysql-virtual_sender_permissions.cf` needs to be adjusted in order for the new **allowed sender** feature to work.

```diff
- query = [old query]
+ query = SELECT GROUP_CONCAT(DISTINCT mu.username SEPARATOR ' ') AS sasl_users FROM mail_users mu WHERE mu.username = '%s' OR mu.email in ((SELECT mail_virtual.email_full FROM mail_virtual WHERE mail_virtual.email = '%s') UNION (SELECT mail_virtual.destination FROM mail_virtual WHERE mail_virtual.email = '%s') UNION (SELECT mail_sender_aliases.email FROM mail_sender_aliases WHERE mail_sender_aliases.allowed_sender = '%s'));
```

### Upgrade debian 12 (bookworm) to 13 (trixie)

The latest stable debian release upgrades dovecot to version 2.4 which brings a lot of breaking configuration changes (see [here](https://doc.dovecot.org/main/installation/upgrade/2.3-to-2.4.html)).

While reconfiguring of the services is required after a dist-upgrade as always, there is a setting you should check beforehand: `Use froxlor Let's Encrypt certificate for these services` (in `Settings` -> `SSL settings`).

**If this is used, please ensure you've selected `dovecot >=2.4` instead of `dovecot <=2.3` (if selected)**
